@using EventBookingApp.Services
@using ContentModels = EventBookingApp.Models;
@inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<ContentModels.Event>
@inject IBookingService BookingService
@{
    Layout = null;
    // Get the event's capacity
    int capacity = Model.Value<int>("capacity");

    // Get the current event's ID
    int eventId = Model.Id;

    // Count the number of bookings for this event
    int bookingCount = BookingService.GetBookingCount(eventId);

    // Check if the event is fully booked
    bool isFullyBooked = bookingCount >= capacity;
    int remainingSlots = capacity - bookingCount;
}
<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
</head>
<body>
    <div class="container mt-5">
        <h1>@Model.Name</h1>
        <p><strong>Date:</strong> @Model.Value("eventDate")</p>
        <p><strong>Location:</strong> @Model.Value("location")</p>
        <p><strong>Description:</strong> @Model.Value("description")</p>
        <p><strong>Capacity:</strong> @Model.Value("capacity")</p>
        <p><strong>Remaining Slots:</strong> @remainingSlots</p>

        @if (TempData["Success"] != null)
        {
            <div class="alert alert-success" id="successMessage" style="width: 50%; margin: auto;">
                @TempData["Success"]
            </div>
        }
        @if (TempData["Error"] != null)
        {
            <div class="alert alert-danger" id="errorMessage" style="width: 50%; margin: auto;">
                @TempData["Error"]
            </div>
        }

        @if (isFullyBooked)
        {
            <h2 class="text-center">Event Fully Booked</h2>
            <p class="alert alert-danger text-center fw-bold">
                Sorry, this event is at full capacity (@capacity bookings). Stay tuned for future openings!
            </p>
        }

        else
        {
            <h2>Book This Event</h2>
            @using (Html.BeginUmbracoForm("BookEvent", "BookingSurface", FormMethod.Post))
            {
                <div class="w-50">
                    <input type="hidden" name="eventId" value="@Model.Id" />
                    <div class="mb-3">
                        <label for="firstName" class="form-label">First Name:</label>
                        <input type="text" name="firstName" id="firstName" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label for="surname" class="form-label">Surname:</label>
                        <input type="text" name="surname" id="surname" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label for="userEmail" class="form-label">Your Email:</label>
                        <input type="email" name="userEmail" id="userEmail" class="form-control" required />
                    </div>
                    <div class="mb-3">
                        <label for="phoneNumber" class="form-label">Phone Number:</label>
                        <input type="tel" name="phoneNumber" id="phoneNumber" class="form-control" required pattern="\+?[0-9\s\-\(\)]{7,}" placeholder="Phone number"
                               title="Enter a valid phone number (e.g., +234-456-7890 or 09034567890)" />
                    </div>
                    <button type="submit" class="btn btn-primary mx-auto">Book Now</button>
                </div>
            }
        }
            
    </div>

    <script>
        setTimeout(function () {
            document.getElementById("successMessage")?.remove();
            document.getElementById("errorMessage")?.remove();
        }, 10000); // 10 seconds
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
</body>
</html>


@* @inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage<Event>
@{
    Layout = null;
}
<!DOCTYPE html>
<html>
<head>
    <title>@Model.Name</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>@Model.Name</h1>
        <p><strong>Date:</strong> @Model.Value("eventDate")</p>
        <p><strong>Location:</strong> @Model.Value("location")</p>
        <p><strong>Description:</strong> @Model.Value("description")</p>
        <p><strong>Capacity:</strong> @Model.Value("capacity")</p>

        @if (TempData["Success"] != null)
        {
            <p class="text-success">@TempData["Success"]</p>
        }
        @if (TempData["Error"] != null)
        {
            <p class="text-danger">@TempData["Error"]</p>
        }

        <h2>Book This Event</h2>
        @using (Html.BeginUmbracoForm("BookEvent", "BookingSurface", FormMethod.Post))
        {
            <input type="hidden" name="eventId" value="@Model.Id" />
            <div class="mb-3">
                <label for="userEmail" class="form-label">Your Email:</label>
                <input type="email" name="userEmail" id="userEmail" class="form-control" required />
            </div>
            <button type="submit" class="btn btn-primary">Book Now</button>
        }
    </div>
</body>
</html> *@



@* @inherits Umbraco.Cms.Web.Common.Views.UmbracoViewPage
@{
    Layout = null;
}
<!DOCTYPE html>
<html>
    <head>
        <title>@Model.Name</title>
    </head>
    <body>
        <h1>@Model.Name</h1>
        <p><strong>Date:</strong> @Model.Value("eventDate")</p>
        <p><strong>Location:</strong> @Model.Value("location")</p>
        <p><strong>Description:</strong> @Model.Value("description")</p>
        <p><strong>Capacity:</strong> @Model.Value("capacity")</p>

        @if (TempData["Success"] != null)
        {
            <p style="color: green;">@TempData["Success"]</p>
        }
        @if (TempData["Error"] != null)
        {
            <p style="color: red;">@TempData["Error"]</p>
        }

        <h2>Book This Event</h2>
        @using (Html.BeginUmbracoForm("BookEvent", "BookingSurface", FormMethod.Post))
        {
            <input type="hidden" name="eventId" value="@Model.Id" />
            <label for="userEmail">Your Email:</label>
            <input type="email" name="userEmail" id="userEmail" required />
            <button type="submit">Book Now</button>
        }
    </body>
</html>*@
 